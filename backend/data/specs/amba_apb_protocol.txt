AMBA APB Protocol Specification Summary

The AMBA (Advanced Microcontroller Bus Architecture) APB (Advanced Peripheral Bus) protocol is a low-cost, low-power, and synchronous interface designed for connecting low-bandwidth peripheral devices in System-on-Chip (SoC) designs. It is not pipelined, and every transfer requires a minimum of two clock cycles to complete. All signal transitions are synchronized to the rising edge of the PCLK signal.

### Key Signals of the AMBA APB Protocol:

Signals in the AMBA APB protocol typically have a 'P' prefix and are active HIGH, with active LOW signals containing a lowercase 'n' in their name.

*   **PCLK (Peripheral Clock):** This is the primary clock signal that times all operations and transfers on the APB bus. All APB signals are timed against its rising edge.
*   **PRESETn (Peripheral Reset):** An active-LOW signal used to reset the system.
*   **PADDR (Peripheral Address):** This is the address bus, carrying the address from the bus master (typically an APB bridge) to the selected slave peripheral. It can be up to 32 bits wide.
*   **PSELx (Peripheral Select):** Generated by the APB bridge, this signal selects a specific slave peripheral. There is a PSEL signal for each slave, indicating that the slave is selected and a data transfer is required.
*   **PENABLE (Peripheral Enable):** This signal indicates the "Access phase" of a transfer. It is asserted HIGH for one cycle of PCLK to enable a bus transfer and signifies the second and subsequent cycles of a transfer.
*   **PWRITE (Peripheral Write):** Dictates the direction of the data transfer. When HIGH, it indicates a write access; when LOW, it indicates a read access.
*   **PWDATA (Peripheral Write Data):** This bus carries write data from the master to the slave during write cycles (when PWRITE is HIGH). It can be 8, 16, or 32 bits wide.
*   **PRDATA (Peripheral Read Data):** This bus carries read data from the slave back to the master during read cycles (when PWRITE is LOW). It can also be up to 32 bits wide.
*   **PREADY (Peripheral Ready):** Used by the slave to extend a transfer by inserting wait states. If the slave is not ready to complete the transaction, it de-asserts PREADY (drives it LOW).
*   **PSLVERR (Peripheral Slave Error):** An optional signal used by the slave to indicate a transfer failure.
*   **PPROT (Protection Type - APB4):** Indicates the protection level of the transaction, such as non-secure/secure or data/instruction access.
*   **PSTRB (Write Strobe - APB4):** Enables sparse data transfer on the write data bus, indicating which byte lanes to update during a write transfer.

### Timing and Transfer Phases:

APB transfers are characterized by their simple, unpipelined, and synchronous nature, always taking at least two clock cycles. The transfers consist of two main phases:

1.  **Setup Phase (T1):**
    *   This is the first clock cycle of any transfer.
    *   The master drives the address (PADDR), selects the target slave (PSELx), and if it's a write, sets PWRITE and places write data (PWDATA) on the bus.
    *   PSELx is asserted HIGH.
    *   PENABLE is LOW during this phase.

2.  **Access Phase (T2 and beyond):**
    *   This phase begins in the clock cycle immediately following the Setup Phase.
    *   PENABLE is asserted HIGH, indicating that the access phase has started and that address, data, and control signals are stable and valid.
    *   For a **write transfer**, the data on PWDATA is written to the selected peripheral.
    *   For a **read transfer**, the slave provides the read data (PRDATA) to the master.
    *   **Wait States:** The slave can extend the Access Phase by driving PREADY LOW. The transfer will not complete until PREADY is HIGH, allowing the slave to take additional clock cycles if it's not ready to complete the transaction immediately.
    *   The transaction completes when PENABLE and PREADY are both HIGH at the same time.

Essentially, a typical APB transfer without wait states completes in two clock cycles: one for the Setup phase and one for the Access phase. Transfers with wait states will extend the Access phase for as many cycles as PREADY is held LOW by the slave.
